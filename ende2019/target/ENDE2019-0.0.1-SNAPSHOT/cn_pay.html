<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./statics/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/css/index.min.css">
    <link rel="stylesheet" href="./assets/css/common.min.css_vv20180704.css">
    <style>
        .content{
				width: 936px;
				background: #fff;
				position: relative;
				margin: 30px auto;
				padding: 20px;
			}
			.content .reg-intro-text{
				color: #999
			}
			.content .top{
				width: 100%;
				float: left;
				position: relative;
			}
			.content .reg-description-text{
				color: #999
			}
			.content .header{
				margin: 0 20px 0;
				min-height: 50px;
				position: relative;
				width: 896px;
			}
			.content .logoRight{
				display: inline-block;
				width: 300px;
				vertical-align: middle;
				padding-left: 30px;
				line-height: 1.8em;
				color: #6E8EA5
			}
			.content .middle {
				padding: 10px 20px;
				clear: both;
				position: relative;
			}
			.content h1{
				z-index: 1000;
				padding: 30px 0 20px;
				clear: both;
				color: #46c2ba;
				text-align: center;
			}
			.content .section-header{
				color: #6E8EA5;
				background: #AAD5EE;
				font-size: 1.6em;
				letter-spacing: 1px;
				text-transform: uppercase;
				padding: 5px;
			}
			.content .reg-process-content{
				padding: 10px 0;
				float: left;
				width: 100%;
			}
			.content .reg-confirmation-login{
				margin: 0 0 15px 0;
				float: left;
				width: 100%;
				overflow: hidden;
				position: relative;
			}
			.content .reg-field-container{
				background: #E5F2FA;
				margin: 0 0 2px 0;
				padding: 5px 10px 3px 10px;
				overflow: hidden;
				float: left;
				width: 99%;
				position: relative;
			}
			.content .reg-process-row{
				float: left;
				width: 100%;
			}
			.content .reg-field-left-column{
				width: 40%;
				float: left;
				text-align: right;
				padding: 0 10px 0 0;
				font-weight: bold;
				color: #cc0000;
			}
			.gray{
				color: #999;
			}
    .pay-title{
        background: #0A78C8;
        color: aliceblue;
        border-radius: 5px;
        text-indent: .5em;
        font-size: 16px;
        padding: 8px 0;
        margin-top: 8px;
    }
    .pay-title .glyphicon{
        vertical-align: middle
    }
    .pay-type{
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }
    .pay-type .pay-item{
        width: 150px;
        height: 70px;
        background: url("./assets/images/wx.jpg") no-repeat center;
        background-size: 60%;
        border: 1px #bbb solid;
        cursor: pointer;
    }
    .pay-type .pay-item:nth-of-type(1){
        background-size: 50%;
        border-color: #0A78C8
    }
    .pay-type .pay-item:nth-of-type(2){
        background-image: url("./assets/images/zfb.jpg")
    }
    .pay-type .pay-item:nth-of-type(3){
        background-image: url("./assets/images/paypal.jpg");
    }
    .pay-type-info{
        margin: 30px 0 20px;
        text-align: center
    }
    .pay-type-info span{
        font-size: 16px;
        font-weight: bold;
        color: #0A78C8
    }
    .hide{display:none;}
    </style>
    <title>pay</title>
</head>
<body>
<div class="content">
			<div class="top">
				<a href="/cn_index.html"><img src="./assets/images/logo.png" alt=""></a>
				<div class="logoRight">
            <p>第24届国际电磁无损评估研讨会 <br>
                (ENDE2019)<br>
                四川成都龙之梦酒店<br>
                2019年9月11日至14日
            </p>
				</div>
			</div>
    <div class="bottom clearfix">
            <div class="clearfix">
                <h1>ENDE 2019</h1>
                <div class="reg-intro-text">
                    <p>
                        <strong style="text-align: justify;">
                            <span style="font-family: Arial, Helvetica, sans-serif;">
    
                                <em>
                                    &nbsp;<br>用户须知<br>
                                </em>
                            </span>
                        </strong>
                        <span style="text-align:justify; font-family: Arial, Helvetica, sans-serif;">
                            <br>
							请选择一位已注册的参会人然后点击底部“支付”按钮进行付款。如果您还未注册参会人，请先返回主页然后点击右侧按钮菜单中的“参会注册”按钮完成注册。在线缴费支持微信、支付宝、Paypal（仅限美元）三种方式，请根据您的需求选择相应的支付方式。除以上三种方式外，参会人还可在会议现场接待处缴费，时间为2019年9月11日至13日，现场可用借记卡、信用卡和现金。无论通过何种方式缴费，会议费用发票只能在会议期间从现场领取（可代领）。
							<br>
							<br>
							如果您有任何关于支付的疑问，欢迎通过大会官方电邮随时联系我们： ende2019@sina.com。
                            <br>
    
                        </span>
                    </p>
                </div>
                <h2 class="section-header" style="position:relative">
                    <span>注册费支付</span>
                    <div style=" position: absolute; left: 350px; bottom:1px; font-size: 18px;">
                        <label for="">币种： </label>
                        <select name="" id="choosebz">
						    <option value="rmb">人民币 ￥</option>
							<option value="dollar">美元 $</option>
                        </select>
                    </div>
                </h2>
                <div class="reg-process-content">
                    <div class="reg-description-text">
                        <p><span>
                            <strong></strong>
                        </span></p>
                    </div>
                    
                </div>
            </div>
        </div>
    <div class="news" style="width:100%">
        <p class="pay-title"><i class="glyphicon glyphicon-user"></i> 参会人名单：</p>
        <table class="table table-bordered table-hover userInfo" id="RegistrationTable">
                <thead>
                        <tr>
                            <th>名称</th>
                            <th>注册类型</th>
                            <th>金额</th>
                            <th>打印海报（仅限学生参会人）</th>
                            <th>小计</th>
                            <th>选择</th>
                            <th>修改</th>
                        </tr>
                </thead>
                <tbody>
                </tbody>
        </table>
    	<div class="row">
    		<div class="col-md-5 col-md-offset-6" id="page_nav">     </div>			
    	</div>

        <div style="display: flex; justify-content:space-between;padding: 20px 0; line-height: 46px;">
            
            <p class="text-center" style=" font-size: 20px;">总计： <span style="color:#ff9900" class="totalPay">0.00</span></p>
            <div>
                <button class="btn btn-primary btn-lg pull-right infoSure Confirm-registration" data-toggle="modal" data-target="#myModal" disabled>支付</button>
            </div>
            
        </div>
            
        <div class="text-center" style="margin-top: 30px;">
            
        </div>
    </div>
</div>


<div class="modal fade" tabindex="-1" role="dialog" id="myModal">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title">支付</h4>
            </div>
            <div class="modal-body">
                <p class="pay-title" style="background-color: #62b900">
                    个人信息
                    <p class="pull-right bz" style="margin:-40px 20px 0 0; color: #fff">币种：
                    	<span style="color:#fff" class="totalPay" id="orderTotalPay"></span>
                  	</p>
                </p>

                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>名称</th>
                            <th>注册类型</th>
                            <th>金额/th>
                            <th>打印海报（仅限学生参会人）</th>
                            <th>小计</th>
                        </tr>
                    </thead>
                    <tbody class="userInfoTable">
                        
                        
                    </tbody>
                </table>
                <p class="pay-title" style="background-color: #62b900">订单信息</p>
                <table class="table table-bordered" id="orderTable">
                    <thead></thead>
                    <tbody class=" text-center">
                        <tr>
                            <th>订单号</th>
                            <td id="orderNumber"></td>
                        </tr>
                        <tr>
                            <th>名称</th>
                            <td id="orderName">ALIPAY</td>
                        </tr>
                        <tr>
                            <th>创建时间</th>
                            <td id="creationTime"></td>
                        </tr>
                        <tr>
                            <th>支付时间</th>
                            <td id="PaymentTime"></td>
                        </tr>
                    </tbody>
                </table>
                <div class="pay-type-info">
                    <span>Payment method</span>

                </div>
                <div class="pay-type">
                        <div code="weixin" class="pay-item"></div>
                        <div code="alipay" class="pay-item"></div>
                        <div code="paypal" class="pay-item">
                            <p class="text-center" style="margin-top: 49px; font-size: 10px;"> 仅限美元支付</p>
                        </div>
                    </div>
                <div class="wx-code text-center hide">
                    <div class="h4">请在5分钟之内通过微信扫描二维码完成支付/Please Scan the QR code via WeChat within 5 miniues</div>
                    <div class="brcode"><img style="width:150px; height:150px;" src=""></div>
                 </div>
                
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default cancel-pay" data-dismiss="modal">取消</button>
              <button type="button" class="btn btn-primary pay-now">立即支付</button>
            </div>
          </div>
        </div>
</div>
<div class="modal fade" tabindex="-1" role="dialog" id="myModal2">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title">修改注册类型</h4>
            </div>
            <div class="modal-body">                
                <div style="width:80%;margin: 20px auto">
                    <label for="">注册类型</label>
                    <select name="" id="modifyType" style="padding:5px;margin-left: 20px">
                        <option value="0">普通</option>
                        <option value="1">学生</option>
                        <option value="2">陪同人员</option>
                        <option value="3">仅参加晚宴</option>
                    </select>
                </div>   
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
              <button type="button" id="confirmButton" class="btn btn-primary">确认</button>
            </div>
          </div>
        </div>
</div>
<script src="./statics/jquery/3.2.1/jquery.min.js"></script>
<script src="./statics/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
<script src="./assets/js/common.js"></script>
<script type="text/javascript">

//支付模块
//默认使用微信支付
var payType = 'weixin';
//TODO,到时候同学记得替换这里的订单，我会从数据表中查询金额---tab_payment_history表
//var orderId = 'EN201901231213560003';
var orderId;
//定时器
var timer;
$(function(){
	$(".pay-now").click(function(){
		var typeArray = ['alipay', 'weixin', 'paypal'];
		if($.inArray(payType, typeArray) !== -1){
			var code = payType;
			if( code == "weixin" ) {
				weixin(code, orderId);
			} else {
				window.location.href=baseURL+"payment/pay?from=pc&code="+code+"&orderId="+orderId;
			}
		} else {
			alert("暂不支持的支付方式");
		}
	});
	//取消支付
	$('.cancel-pay').click(function(){
		window.clearTimeout(timer);
		$('.pay-now').attr("disabled", false);
		if(!$(".wx-code").hasClass('hide')){
			$(".wx-code").addClass('hide')
		}
	});
})

//微信二维码拉取
function weixin(code, orderId) {
	$.get(baseURL+"payment/pay?from=pc&code="+code+"&orderId="+orderId, function(response){
		if(response != "0"){
			$(".wx-code").find('img').attr("src", baseURL+"payment/code?code_url="+response);
			$(".wx-code").removeClass("hide");
			$('.pay-now').attr("disabled", true);
			//轮询，查询订单状态,3秒钟一次
			timer = setTimeout(function(){
				inquire(orderId);
			}, 3000);
			//5分钟后刷新二维码
			setTimeout(function(){
				weixin(code, orderId);
			}, 300000);
		} else {
			alert("二维码拉去失败或者订单信息有误")
		}
	});
}

//轮询获取微信支付状态
function inquire(orderId) {
	$.get(baseURL+"payment/weixin?orderId="+orderId, function(response){
		if(response == "1"){
			window.location.href="paySuccess.html?orderId="+orderId;
		} else {
			timer = setTimeout(function(){
				inquire(orderId);
			}, 3000);
		}
	});
}
</script>
<script>
	var creationTime;//订单创建时间
	var record = 0;
$(".pay-item").click(function(){
    $(".pay-item").css("borderColor","#bbb");
    $(this).css("borderColor","#0A78C8");
    payType = $(this).attr("code");
});

//勾选打印计算
$(document).on("click",".printPic",function(){
	is_print($(this));
})

function is_print(element)
{
	console.log($("#choosebz").val())
	if ($("#choosebz").val() == 'dollar') {
		for (let i = 0; i < element.length; i++) {
			var p = element.eq(i).is(':checked')
	        if (p) {
	            element.eq(i).parent("td").next("td").html('365');
	        } else {
	            element.eq(i).parent("td").next("td").html('350');
	        }
        }
    } else {
		for (let i = 0; i < element.length; i++) {
			var p = element.eq(i).is(':checked')
	        if (p) {
	            element.eq(i).parent("td").next("td").html('2600');
	            element.eq(i).parent("td").next("td")
	        } else {
	            element.eq(i).parent("td").next("td").html('2500');
	        }
        }
    	
    }
    calc()
}

$(document).on("click",".choose",function(){
	if(!this.checked){
		record = record - 1;
	}
	if(record >= 5){
		this.checked = false;
		alert("缴费人数不能超过5人");
	    return;
	}
	else if(this.checked){
		record = record + 1;
	}
	calc()
})

var rmb = [3500,2500,1200,350]
var dollar = [500,350,150,50]
$(".pay-type").find(".pay-item:eq(0)").show()
$(".pay-type").find(".pay-item:eq(1)").show()
$(".pay-type").find(".pay-item:eq(2)").hide()
$("#choosebz").change(function(){
    if ($(this).val() == 'rmb') {
		$(".pay-type").find(".pay-item:eq(0)").show()
		$(".pay-type").find(".pay-item:eq(1)").show()
		$(".pay-type").find(".pay-item:eq(2)").hide()
        $(".price").each(function(i, el){
        	var price = $(".price:eq("+i+")");
        	var total = $(".price:eq("+i+")").next("td").next("td");
        	var priceValue = price.val();
        	if(priceValue == "500")
        	{
        		price.val("3500");
        		price.html("￥3500");
        		total.html("3500");
        	}
        	else if(priceValue == "350")
        	{
        		price.val("2500");
        		price.html("￥2500");
        		total.html("2500");
        	}
        	else if(priceValue == "150")
        	{
        		price.val("1200");
        		price.html("￥1200");
        		total.html("1200");
        	}
        	else if(priceValue == "50")
        	{
        		price.val("350");
        		price.html("￥350");
        		total.html("350");
        	}
        })
    } else {
		$(".pay-type").find(".pay-item:eq(0)").hide()
		$(".pay-type").find(".pay-item:eq(1)").hide()
		$(".pay-type").find(".pay-item:eq(2)").show()
        $(".price").each(function(i, el){
            var price = $(".price:eq("+i+")");
            var total = $(".price:eq("+i+")").next("td").next("td");
        	var priceValue = price.val();
        	if(priceValue == "3500")
        	{
        		price.val("500");
        		price.html("$500");
        		total.html("500");
        	}
        	else if(priceValue == "2500")
        	{
        		price.val("350");
        		price.html("$350");
        		total.html("350");
        	}
        	else if(priceValue == "1200")
        	{
        		price.val("150");
        		price.html("$150");
        		total.html("150");
        	}
        	else if(priceValue == "350")
        	{
        		price.val("50");
        		price.html("$50");
        		total.html("50");
        	}
        })
    }
	is_print($(".printPic"));
    
})

$(".Confirm-registration").click(function(){
	generate_Order();
	show_Order();	
})
	
function generate_Order(){
	var jsonData = {}
	var orderuserArray = []; //订单用户数组
    var RegisterChoose = $(".choose"); //#RegistrationTable
    for (let i = 0; i < RegisterChoose.length; i++) {
    	var registrationUser = $(".userInfo tbody tr:eq("+ i +") ");
    	var registrationType = registrationUser.find("td:eq(1)");
    	var printPoster = registrationUser.find("td:eq(3)");
    	var subtotal = registrationUser.find("td:eq(4)");
        if (RegisterChoose[i].checked) {
        	var conferenceUser = {};
        	conferenceUser["conferenceUserId"] = registrationUser.attr("conferenceUserId"); //会议注册用户id
        	if(registrationType.val() != 1)
        	{
        		conferenceUser["printPoster"] = "0"; //是否打印海报
        	}
        	else 
        	{
        		if(printPoster.children(".printPic").is(':checked'))
        			conferenceUser["printPoster"] = "1";
        		else
        			conferenceUser["printPoster"] = "0";
        	}
			conferenceUser["userId"] = getCookie("userid"); //网站用户id
			orderuserArray.push(conferenceUser);
        }
    }
    jsonData["orderuserArray"] = orderuserArray;
    var jsonString = JSON.stringify(jsonData);
    $.ajax({
		type:"POST",
		url:baseURL+"Generate_Order",
		data:{"orders":jsonString},
		async:false,
		success:function(result){
			orderId = result.data.orderNumber;
			creationTime = result.data.creationTime;	
		},
		error:function(){
		    alert("ajax fail...");
		   }
	});
}
	
function show_Order()
{
	$(".userInfoTable").html("");
    var RegisterChoose = $("#RegistrationTable .choose");
    var hml = "";
    for (let i = 0; i < RegisterChoose.length; i++) {
        if (RegisterChoose[i].checked) {
            hml+="<tr>"+
            "<td>"+ $(".userInfo tbody tr:eq("+ i +")").find("td:eq(0)").html() +"</td>"+
            "<td>"+ $(".userInfo tbody tr:eq("+ i +")").find("td:eq(1)").html() +"</td>"+
            "<td>"+ $(".userInfo tbody tr:eq("+ i +")").find("td:eq(2)").html() +"</td>"+
            "<td>"+
            ($(".userInfo tbody tr:eq("+ i +")").find("td:eq(3)").find("input").is(":checked")?"Yes":"No")
            +"</td>"+
            "<td>"+ $(".userInfo tbody tr:eq("+ i +")").find("td:eq(4)").html() +"</td>"+
            "</tr>"
        }        
    }
    $(".userInfoTable").append(hml);
    
	var searchChoose = $("#searchTable .choose");
    var searchHml = "";
    for (let i = 0; i < searchChoose.length; i++) {
        if (searchChoose[i].checked) {
            searchHml+="<tr>"+
            "<td>"+ $("#searchTable tbody tr:eq("+ i +")").find("td:eq(0)").html() +"</td>"+
            "<td>"+ $("#searchTable tbody tr:eq("+ i +")").find("td:eq(1)").html() +"</td>"+
            "<td>"+ $("#searchTable tbody tr:eq("+ i +")").find("td:eq(2)").html() +"</td>"+
            "<td>"+
            ($("#searchTable tbody tr:eq("+ i +")").find("td:eq(3)").find("input").is(":checked")?"Yes":"No")
            +"</td>"+
            "<td>"+ $("#searchTable tbody tr:eq("+ i +")").find("td:eq(4)").html() +"</td>"+
            "</tr>"
        }
    }
    $(".userInfoTable").append(searchHml);
/***************************************生成订单***************************************/   	
	$("#orderNumber").html(orderId).attr("orderNumber",orderId);
	$("#orderName").html(getCookie("username"));
	$("#creationTime").html(creationTime);
}

function calc(){
    var total = 0
    $(".choose").each(function(i, el){
       if (el.checked) {
           total+= parseInt( $(".num:eq(" + i + ")").text().replace("$", "") ) 
       }
    })

    
    var unit = $("#choosebz").val();
    if(unit == "rmb")
    {
    	$(".totalPay").html(total + " 人民币");
    	$("#orderTotalPay").html(total + " 人民币");
    }
    else if(unit == "dollar")
    {
    	$(".totalPay").html(total + " 美元");
    	$("#orderTotalPay").html(total + " 美元");
    }
    
    $("#orderTotalPay").attr("total",total); 
    
}

//判断无选项时无法支付
$('#RegistrationTable').on('click','.choose', function(){
	if ($('.choose').is(':checked')) {
		$(".Confirm-registration").removeAttr("disabled")
	} else {
		$(".Confirm-registration").attr("disabled","disabled")
	}
})
</script>
<script>
	$(function(){
    	to_page(1);
    	var searchName;
    })
	function to_page(pn){
		$.ajax({
			url:baseURL+"queryRegistration",
			data:"page="+pn,
			type:"GET",
			async:false,
			success:function(result){
				//1、解析显示数据
				conferenceUser_table(result);
				//2、显示分页条
				build_page_nav(result);
			},
			error:function(){
	    		alert("ajax fail...");
	    		
	    	}
		});
	}
	
	function conferenceUser_table(result)
	{
		$("#RegistrationTable tbody").empty();
		var users = result.data.PageInfo.list;
		$.each(users,function(index,item){
			var name = $("<td></td>").append(item.name);
			var isStudent = item.isStudent;
			if(isStudent == "0")
			{
				var registrationType = $("<td></td>").append("普通").val("0");
				var amount = $("<td></td>").append("3500").val(3500).addClass("price");
				var printPoster = $("<td></td>").append("No").val("0");
				var subtotal = $("<td></td>").append(3500).addClass("num");
					subtotal.attr("dollarAmount",500);
					subtotal.attr("rmbAmount",3500);
			}	
			else if(isStudent == "1")
			{
				var registrationType = $("<td></td>").append("学生").val("1");
				var amount = $("<td></td>").append("2500").val(2500).addClass("price");
				var printPoster = $("<td></td>");
					var printprice = $("<input type='checkbox'>").addClass("printPic");
				printPoster.append(printprice);
				var subtotal = $("<td></td>").append(2500).addClass("num");
					subtotal.attr("dollarAmount",350);
					subtotal.attr("rmbAmount",2500);
			}
			else if(isStudent == "2")
			{
				var registrationType = $("<td></td>").append("陪同人员").val("2");
				var amount = $("<td></td>").append("1200").val(1200).addClass("price");
				var printPoster = $("<td></td>").append("No").val("0");
				var subtotal = $("<td></td>").append(1200).addClass("num");
					subtotal.attr("dollarAmount",150);
					subtotal.attr("rmbAmount",1200);
			}
			else if(isStudent == "3")
			{
				var registrationType = $("<td></td>").append("仅参加晚宴").val("3");
				var amount = $("<td></td>").append("350").val(350).addClass("price");
				var printPoster = $("<td></td>").append("No").val("0");
				var subtotal = $("<td></td>").append(350).addClass("num");
					subtotal.attr("dollarAmount",50);
					subtotal.attr("rmbAmount",350);
			}
			var operation = $("<td></td>");
					var choose = $("<input type='checkbox'>").addClass("choose");
			operation.append(choose);
			var modify = $("<td></td>");
				var modifyButton = $("<button data-toggle='modal' data-target='#myModal2' id='modifyButton'></button>")
									.addClass("btn btn-primary")
									.append("修改注册类型");
				modifyButton.attr("conferenceUserId",item.id);
				modifyButton.attr("registrationType",item.isStudent);
			modify.append(modifyButton);
			
			$("<tr></tr>").append(name)
						.append(registrationType)
						.append(amount)
						.append(printPoster)
						.append(subtotal)
						.append(operation)
						.append(modify).attr("conferenceUserId",item.id).appendTo("#RegistrationTable tbody");
		});
	}

	function build_page_nav(result)
	{
		$("#page_nav").empty();
		var ul = $("<ul></ul>").addClass("pagination");
		var firstPage = $("<li></li>").append($("<a></a>").append("首页"));
		var prePage = $("<li></li>").append($("<a></a>").append("&laquo;")); 
		if(result.data.PageInfo.hasPreviousPage == false)
		{
			firstPage.addClass("disabled");
			prePage.addClass("disabled");
		}else{
			firstPage.click(function()
	    	{
    			to_page(1);
	    	});
    		prePage.click(function()
    	    {
    	    	to_page(result.data.PageInfo.pageNum-1);
    	    });
		}
		var nextPage = $("<li></li>").append($("<a></a>").append("&raquo;")); 
		var lastPage = $("<li></li>").append($("<a></a>").append("尾页"));
		if(result.data.PageInfo.hasNextPage == false)
		{
			nextPage.addClass("disabled");
			lastPage.addClass("disabled");
		}else{
			nextPage.click(function()
    	    {
    	    	to_page(result.data.PageInfo.pageNum+1);
    	    });
    		lastPage.click(function()
    	    {
    	    	to_page(result.data.PageInfo.pages);
    	    });
		}
		
		ul.append(firstPage).append(prePage);
		$.each(result.data.PageInfo.navigatepageNums,function(index,item){
			var num = $("<li></li>").append($("<a></a>").append(item));
			if(result.data.PageInfo.pageNum==item)
			{
				num.addClass("active");
			}
			num.click(function(){
				to_page(item);
			});
			ul.append(num);
		});
		
		ul.append(nextPage).append(lastPage);
		var nav = $("<nav></nav>").append(ul);
		$("#page_nav").append(nav);
	}

	$(document).on("click","#modifyButton",function(){
		var registrationType = $(this).attr("registrationType");
		$("#modifyType").val([registrationType]);
		$("#confirmButton").attr("conferenceUserId",$(this).attr("conferenceUserId"));
	})
	
	$(document).on("click","#confirmButton",function(){
		var conferenceUserId = $(this).attr("conferenceUserId");
		var type = $("#modifyType").val();
		$.ajax({
			url:baseURL+"updateTypeofConferenceUser",
			data:"conferenceUserId="+conferenceUserId+"&"+"type="+type,
			type:"GET",
			async:false,
			success:function(result){
				$("#myModal2").modal('hide');
				to_page(999);
			},
			error:function(){
	    		alert("ajax fail...");	
	    	}
		});
	})
/***********************************************************************************/
	$(document).on("click","#searchButton",function(){
		searchName = $("#searchName").val();
		to_search_page(1);
		if(searchName != "")
		{
			to_search_page(1);
		}
	})
	
	function to_search_page(pn){
		$.ajax({
			url:baseURL+"queryOtherRegistration",
			data:"page="+pn+"&"+"name="+searchName,
			type:"GET",
			async:false,
			success:function(result){
				//1、解析显示数据
				search_table(result);
				//2、显示分页条
				build_search_page_nav(result);
			},
			error:function(){
	    		alert("ajax fail...");	
	    	}
		});
	}
	
	function search_table(result)
	{
		$("#searchTable tbody").empty();
		var users = result.data.PageInfo.list;
		var registerUserid = getCookie("userid"); //网站用户id
		$.each(users,function(index,item){
			var name = $("<td></td>").append(item.name);
			var isStudent = item.isStudent;
			if(isStudent == "0")
			{
				var registrationType = $("<td></td>").append("Regular").val("0");
				var amount = $("<td></td>").append("3500").val(3500).addClass("price");
				var printPoster = $("<td></td>").append("No").val("0");
				var subtotal = $("<td></td>").append(3500).addClass("num");
					subtotal.attr("dollarAmount",500);
					subtotal.attr("rmbAmount",3500);
			}	
			else if(isStudent == "1")
			{
				var registrationType = $("<td></td>").append("Student").val("1");
				var amount = $("<td></td>").append("2500").val(2500).addClass("price");
				var printPoster = $("<td></td>");
					var printprice = $("<input type='checkbox'>").addClass("printPic");
				printPoster.append(printprice);
				var subtotal = $("<td></td>").append(2500).addClass("num");
					subtotal.attr("dollarAmount",350);
					subtotal.attr("rmbAmount",2500);
			}
			else if(isStudent == "2")
			{
				var registrationType = $("<td></td>").append("Accompanying person").val("2");
				var amount = $("<td></td>").append("1200").val(1200).addClass("price");
				var printPoster = $("<td></td>").append("No").val("0");
				var subtotal = $("<td></td>").append(1200).addClass("num");
					subtotal.attr("dollarAmount",150);
					subtotal.attr("rmbAmount",1200);
			}
			else if(isStudent == "3")
			{
				var registrationType = $("<td></td>").append("Banquet ticket only").val("3");
				var amount = $("<td></td>").append("350").val(350).addClass("price");
				var printPoster = $("<td></td>").append("No").val("0");
				var subtotal = $("<td></td>").append(350).addClass("num");
					subtotal.attr("dollarAmount",50);
					subtotal.attr("rmbAmount",350);
			}
			var operation = $("<td></td>");
					var choose = $("<input type='checkbox'>").addClass("choose");
			operation.append(choose);
			
			$("<tr></tr>").append(name)
						.append(registrationType)
						.append(amount)
						.append(printPoster)
						.append(subtotal)
						.append(operation).attr("conferenceUserId",item.id).appendTo("#searchTable tbody");
		});
	}
	
	function build_search_page_nav(result)
	{
		$("#search_page_nav").empty();
		var ul = $("<ul></ul>").addClass("pagination");
		var firstPage = $("<li></li>").append($("<a></a>").append("home page"));
		var prePage = $("<li></li>").append($("<a></a>").append("&laquo;")); 
		if(result.data.PageInfo.hasPreviousPage == false)
		{
			firstPage.addClass("disabled");
			prePage.addClass("disabled");
		}else{
			firstPage.click(function()
	    	{
    			to_search_page(1);
	    	});
    		prePage.click(function()
    	    {
    	    	to_search_page(result.data.PageInfo.pageNum-1);
    	    });
		}
		var nextPage = $("<li></li>").append($("<a></a>").append("&raquo;")); 
		var lastPage = $("<li></li>").append($("<a></a>").append("tail page"));
		if(result.data.PageInfo.hasNextPage == false)
		{
			nextPage.addClass("disabled");
			lastPage.addClass("disabled");
		}else{
			nextPage.click(function()
    	    {
    	    	to_search_page(result.data.PageInfo.pageNum+1);
    	    });
    		lastPage.click(function()
    	    {
    	    	to_search_page(result.data.PageInfo.pages);
    	    });
		}
		
		ul.append(firstPage).append(prePage);
		$.each(result.data.PageInfo.navigatepageNums,function(index,item){
			var num = $("<li></li>").append($("<a></a>").append(item));
			if(result.data.PageInfo.pageNum==item)
			{
				num.addClass("active");
			}
			num.click(function(){
				to_search_page(item);
			});
			ul.append(num);
		});
		
		ul.append(nextPage).append(lastPage);
		var nav = $("<nav></nav>").append(ul);
		$("#search_page_nav").append(nav);
	}

</script>
</body>
</html>